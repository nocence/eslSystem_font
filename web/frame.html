<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
		<!-- Google Chrome Frame也可以让IE用上Chrome的引擎: -->
		<meta name="renderer" content="webkit">
		<!--国产浏览器高速模式-->
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>BlueToothPrice V1.0</title>

		<!-- 公共样式 开始 -->
		<link rel="shortcut icon" href="static/images/favicon.ico"/>
		<link rel="bookmark" href="static/images/favicon.ico"/>
		<link rel="stylesheet" type="text/css" href="static/css/base.css">
		<link rel="stylesheet" type="text/css" href="static/css/iconfont.css">
        <script type="text/javascript" src="static/js/vue.js"></script>
		<script type="text/javascript" src="static/framework/jquery-1.11.3.min.js" ></script>
		<link rel="stylesheet" type="text/css" href="static/layui/css/layui.css">
	    <!--[if lt IE 9]>
	      	<script src="static/framework/html5shiv.min.js"></script>
	      	<script src="static/framework/respond.min.js"></script>
	    <![endif]-->
		<script type="text/javascript" src="static/layui/layui.js"></script>
		<!-- 滚动条插件 -->
		<link rel="stylesheet" type="text/css" href="static/css/jquery.mCustomScrollbar.css">
		<script src="static/framework/jquery-ui-1.10.4.min.js"></script>
		<script src="static/framework/jquery.mousewheel.min.js"></script>
		<script src="static/framework/jquery.mCustomScrollbar.min.js"></script>
		<script src="static/framework/cframe.js"></script><!-- 仅供所有子页面使用 -->
		<!-- 公共样式 结束 -->

		<link rel="stylesheet" type="text/css" href="static/css/frameStyle.css">
		<script type="text/javascript" src="static/framework/frame.js" ></script>
		<!--js和vue引入-->
		<script type="text/javascript" src="static/js/jsencrypt.min.js"></script>

		<script type="text/javascript" src="static/js/axios.min.js"></script>
		<script type="text/javascript" src="static/js/util.js"></script>


	</head>

	<body>
		<div id="myVue">
			<!-- 左侧菜单 - 开始 -->
			<div class="frameMenu">
				<div class="logo">
					<div class="logoText">
						<h1>蓝牙电子价签管理系统</h1>
						<p>BlueToothPriceSystem</p>
					</div>
				</div>
            <!-- 菜单容器 -->
                <div id="index-commonmenu">
                    <ul class="layui-nav layui-nav-tree" lay-filter="demo" style="margin-right:10px;width:250px;height:1007px;"></ul>
                </div>
			</div>
			<!-- 左侧菜单 - 结束 -->

			<div class="main">
				<!-- 头部栏 - 开始 -->
				<div class="frameTop">
					<img class="jt" src="static/images/top_jt.png"/>
					<div class="topMenu">
						<ul>
							<li><a href="javascript:void(0)"><i class="iconfont icon-yonghu1"></i>欢迎您，管理员：{{user.userName}}</a></li>
							<li><a href="javascript:void(0)" onclick="menuCAClick('static/tgls/modify_password.html',this)"><i class="iconfont icon-xiugaimima"></i>修改密码</a></li>
							<li><a href="javascript:void(0)" @click="logout()"><i class="iconfont icon-084tuichu"></i>注销</a></li>
						</ul>
					</div>
				</div>
				<!-- 头部栏 - 结束 -->

				<!-- 核心区域 - 开始 -->
				<div class="frameMain">
					<div class="title" id="frameMainTitle">
						<span><i class="iconfont icon-xianshiqi"></i>后台首页</span>
					</div>
					<div class="con">
						<iframe id="mainIframe" src="http://localhost:8080/eslsystem/swagger-ui.html" scrolling="no">swagger2接口文档</iframe>
					</div>
				</div>
				<!-- 核心区域 - 结束 -->
			</div>
		</div>
        <script type="text/javascript">

            layui.use('element', function(){
                var $ = layui.jquery
                    ,element = layui.element;

                element.on('nav(demo)', function(elem){
                    //console.log(elem.getAttribute("meun_id")); //得到当前点击的DOM对象
                    var id=$(this).attr("meun_id");
                    if(typeof(id)!="undefined"){
                        console.log('进入方法');
                        element.tabAdd('demo1', {
                            title: '新选项'+ (Math.random()*1000|0) //用于演示
                            ,content: '<iframe src="test.html" style="width:100%;height:491px;" scrolling="auto" frameborder="0"></iframe>'
                            ,id: id//实际使用一般是规定好的id，这里以时间戳模拟下z
                        })
                        element.tabChange('demo1', id);
                    }
                });
                var user=JSON.parse(sessionStorage.getItem("loginAdmin"));
                sendAxios(
                    "user/getInitMenus",
                    user
                ).then(res =>{
                    if (res.data.code == 200){
                        console.log(res.data.menus);
                        $.each(res.data.menus,function(i,obj){
                            var content='<li class="layui-nav-item">';
                            content+='<a href="javascript:;">'+obj.perName+'</a>';
                            //这里是添加所有的子菜单
                            content+=loadchild(obj);
                            content+='</li>';
                            $(".layui-nav-tree").append(content);
                        });
                        element.init();
                    }else {
                        alert(res.data.msg)
                    }
                }).catch(res=>{
                    alert("函数执行失败，请联系管理员！");
                });

                //组装子菜单的方法
                function loadchild(obj){
                    if(obj==null){
                        return;
                    }

                    var content='';
                    if(obj.childMenus!=null && obj.childMenus.length>0){
                        content+='<dl class="layui-nav-child">';
                    }else{
                        content+='<dl>';
                    }

                    if(obj.childMenus!=null && obj.childMenus.length>0){
                        $.each(obj.childMenus,function(i,note){
                            content+='<dd>';
                            content+='<a style="font-size:smaller" href="javascript:;" onclick="menuCAClick(\'static/tgls/'+ note.perPageUrl +'\',this)">'+note.perName+'</a>';
                            if(note.childMenus==null){
                                return;
                            }
                            content+=loadchild(note);
                            content+='</dd>';
                        });

                        content+='</dl>';
                    }
                    console.log(content);
                    return content;
                }
            });

            var eu = new Vue({
                el:"#myVue",
                data:{
                    menus:[],
                    user:{}
                },
                methods:{
                },
                created:function(){
                    this.user=JSON.parse(sessionStorage.getItem("loginAdmin"));
                    console.log(this.user);
                },
                logout:function () {
					sendAxios("/logout").then(res=>{
						if(res.data.code == 200){
							alert("注销成功");
							window.location.href = "login.html";
						}else {
							alert(res.data.msg)
						}
					}).catch(res=>{
						alert("函数执行失败，请联系管理员！");
					});
				}
            });


        </script>
	</body>
</html>
